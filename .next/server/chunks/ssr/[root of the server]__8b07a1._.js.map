{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":["file:///Users/relucky/Desktop/programming/react/aitu-net-frontend/src/models/chatMessage.ts"],"sourcesContent":["export enum ChatMessageStatus {\n    RECEIVED,\n    DELIVERED\n}\n\nexport type ChatMessage = {\n    id?: string;\n    chatId: string;\n    sender: string;\n    recipient: string;\n    content: string;\n    timestamp: Date;\n    status: ChatMessageStatus;\n    type: string;\n};\n"],"names":[],"mappings":";;;AAAO,IAAA,AAAK,2CAAA;;;WAAA"}},
    {"offset": {"line": 47, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 53, "column": 0}, "map": {"version":3,"sources":["file:///Users/relucky/Desktop/programming/react/aitu-net-frontend/src/components/ChatPage.tsx"],"sourcesContent":["import {useAuth} from '@/context/AuthProvider';\nimport {Client, Message} from '@stomp/stompjs';\nimport SockJS from 'sockjs-client'\nimport React, {useEffect, useRef, useState} from \"react\";\nimport {useSearchParams} from \"next/navigation\";\nimport {ChatMessage, ChatMessageStatus} from \"@/models/chatMessage\";\nimport {api} from \"@/lib\";\n\nexport default function ChatPage() {\n    const stompClientRef = useRef<Client | null>(null)\n    const {user} = useAuth()\n\n    const [chatRooms, setChatRooms] = useState<Map<string, ChatRoom>>(new Map())\n\n    // grouped chat messages by chatId [chatId: [messages]]\n    const [chatRoomMessages, setChatRoomMessages] = useState<Map<string, ChatMessage[]>>(new Map())\n    const [inputMessage, setInputMessage] = useState<string>('')\n\n    const searchParams = useSearchParams()\n\n    // Current chat id for users\n    const [currentChatId, setCurrentChatId] = useState<string>('')\n    const [currentCompanion, setCurrentCompanion] = useState<string>('')\n\n    useEffect(() => {\n        if (!user) return\n        const stompClient = new Client({\n            webSocketFactory: () => new SockJS('http://localhost:8080/ws'),\n            debug: console.log,\n            onConnect: onConnected,\n            onStompError: (frame) => {\n                console.error('Broker reported error: ' + frame.headers['message'])\n                console.error('Additional details: ' + frame.body)\n            }\n        })\n        stompClient.activate()\n\n        stompClientRef.current = stompClient\n\n        return () => stompClient.deactivate()\n    }, [user])\n\n    const onConnected = async () => {\n        if (!user) return\n        console.log('Successfully connected to STOMP client.')\n        stompClientRef.current?.subscribe(`/user/${user?.email}/queue/messages`, onPrivateMessageReceived)\n\n        const companionEmail = searchParams.get('companionEmail')\n        if (companionEmail) {\n            const {chatId} = await api.chat.getOrCreateChatId(user.email, companionEmail)\n            selectChat(chatId, user.email, companionEmail)\n        }\n\n        fetchAndSetChatRooms()\n    }\n\n    const fetchAndSetChatRooms = async (email: string = user?.email) => {\n        if (!email) return\n\n        const rooms: ChatRoom[] = await api.chat.fetchChatRooms(email)\n        setChatRooms(\n            new Map(rooms.map((chatRoom) => [chatRoom.chatId, chatRoom]))\n        )\n    }\n\n    const fetchAndSetChatRoomMessages = async (sender: string = user?.email, recipient: string = currentCompanion, chatId: string = currentChatId) => {\n        if (!sender || !currentCompanion || !chatId) return\n\n        const messages: ChatMessage[] = await api.chat.fetchChatRoomMessages(sender, recipient)\n        const newChatRoomMessages = new Map(chatRoomMessages)\n        newChatRoomMessages.set(currentChatId, messages)\n\n        setChatRoomMessages(newChatRoomMessages)\n    }\n\n    const onPrivateMessageReceived = (message: Message) => {\n        const chatMessage = JSON.parse(message.body) as ChatMessage;\n\n        if (!chatRooms.has(chatMessage.chatId)) {\n            fetchAndSetChatRooms()\n        }\n\n        setChatRoomMessages(prevChatRoomMessages => {\n            const newChatRoomMessages = new Map(prevChatRoomMessages)\n            const messages = newChatRoomMessages.get(chatMessage.chatId) || []\n            newChatRoomMessages.set(chatMessage.chatId, [...messages, chatMessage])\n            return newChatRoomMessages\n        })\n    }\n\n    const selectChat = async (chatId: string, sender: string | undefined = user?.email, companionEmail: string) => {\n        if (!sender) {\n            return\n        }\n\n        setCurrentChatId(chatId)\n        setCurrentCompanion(companionEmail)\n\n        await fetchAndSetChatRoomMessages(sender, companionEmail, chatId)\n    }\n\n    if (!user) {\n        return <div>Loading...</div>\n    }\n\n    const handleInputMessage = (e: React.ChangeEvent<HTMLInputElement>) => {\n        e.preventDefault()\n        setInputMessage(e.target.value)\n    }\n\n    const sendMessage = () => {\n        const stompClient = stompClientRef.current\n        if (!user || !stompClient || inputMessage.trim() === '') return\n\n        console.log(`sending message: ${inputMessage} to ${currentCompanion} from ${user.email}`)\n\n        const message: ChatMessage = {\n            chatId: currentChatId,\n            type: 'MESSAGE',\n            content: inputMessage,\n            recipient: currentCompanion,\n            sender: user.email,\n            status: ChatMessageStatus.DELIVERED,\n            timestamp: new Date()\n        }\n\n        stompClient.publish({\n            destination: '/app/chat',\n            body: JSON.stringify(message)\n        })\n\n\n        setInputMessage('')\n\n        setChatRoomMessages(prevChatRoomMessages => {\n            const newChatRoomMessages = new Map(prevChatRoomMessages)\n            const messages = newChatRoomMessages.get(currentChatId) || []\n            message.id = crypto.randomUUID()\n            newChatRoomMessages.set(currentChatId, [...messages, message])\n            return newChatRoomMessages\n        })\n\n        if (!chatRooms.has(currentChatId)) {\n            setChatRooms(prevChatRooms => {\n                const newChatRooms = new Map(prevChatRooms)\n                newChatRooms.set(currentChatId, {\n                    id: crypto.randomUUID(),\n                    chatId: currentChatId,\n                    sender: user.email,\n                    recipient: currentCompanion\n                })\n                return newChatRooms\n            })\n        }\n    }\n\n    if (!user) {\n        return <div>Loading...</div>\n    }\n\n    return (\n        <div className=\"h-screen bg-black text-gray-300 flex overflow-hidden\">\n            {/* Sidebar (Fixed height, scrollable list inside) */}\n            <aside className=\"w-1/4 bg-gray-900 p-4 h-screen shadow-lg flex flex-col overflow-hidden\">\n                <h3 className=\"text-lg font-semibold text-white mb-4\">Chats</h3>\n                <ul className=\"space-y-2 overflow-y-auto flex-1\">\n                    {[...chatRooms.values()].map((chatRoom: ChatRoom) => (\n                        <li key={chatRoom.id}>\n                            <button\n                                className=\"w-full bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded transition text-left\"\n                                onClick={() => selectChat(chatRoom.chatId, user?.email, chatRoom.recipient)}\n                            >\n                                {chatRoom.recipient}\n                            </button>\n                        </li>\n                    ))}\n                </ul>\n            </aside>\n\n            {/* Main Chat Area */}\n            <main className=\"flex-1 p-6 flex flex-col h-screen overflow-hidden\">\n                <h1 className=\"text-2xl font-bold text-white\">{currentCompanion}</h1>\n\n                <div className=\"w-full bg-gray-900 p-4 rounded-lg shadow-lg mt-4 flex flex-col flex-1 overflow-hidden\">\n                    {/* Scrollable Messages Section */}\n                    <div className=\"flex-1 overflow-y-auto p-2 space-y-2\">\n                        {currentCompanion ? (\n                            (chatRoomMessages.get(currentChatId) || []).map((chatMessage: ChatMessage) => (\n                                <div\n                                    key={chatMessage.id}\n                                    className={`p-3 rounded max-w-[75%] ${\n                                        chatMessage.sender === user.email\n                                            ? \"bg-blue-600 text-white ml-auto\"\n                                            : \"bg-gray-800 text-gray-300\"\n                                    }`}\n                                >\n                                    {chatMessage.content}\n                                </div>\n                            ))\n                        ) : (\n                            <div className=\"text-gray-400 flex items-center justify-center h-full\">\n                                Select a chat to start messaging\n                            </div>\n                        )}\n                    </div>\n\n                    {/* Sticky Message Input Bar */}\n                    {currentCompanion && (\n                        <div className=\"mt-4 flex p-2 bg-gray-800 rounded-b-lg\">\n                            <input\n                                type=\"text\"\n                                className=\"flex-grow p-2 rounded bg-gray-700 border border-gray-600 text-white\"\n                                placeholder={`Enter message for ${currentCompanion}`}\n                                onChange={handleInputMessage}\n                                value={inputMessage}\n                                onKeyDown={e => e.key === 'Enter' && (e.preventDefault(), sendMessage())}\n                            />\n                            <button\n                                className=\"ml-2 bg-blue-600 hover:bg-blue-500 px-4 py-2 text-white rounded transition\"\n                                onClick={sendMessage}\n                            >\n                                Send\n                            </button>\n                        </div>\n                    )}\n                </div>\n            </main>\n        </div>\n    )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 341, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 347, "column": 0}, "map": {"version":3,"sources":["file:///Users/relucky/Desktop/programming/react/aitu-net-frontend/src/app/chat/page.tsx"],"sourcesContent":["'use client'\nimport ChatPage from '@/components/ChatPage';\n\nexport default function LoginPage() {\n    return <ChatPage />;\n}\n"],"names":[],"mappings":";;;;AACA;AADA;;;AAGe,SAAS;IACpB,qBAAO,8OAAC,8HAAA,CAAA,UAAQ;;;;;AACpB"}},
    {"offset": {"line": 362, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}